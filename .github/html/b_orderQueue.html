<!DOCTYPE html>
<html>

<head>
    <title>Order Queue</title>
</head>

<body>
    <div class="header">
        <a href="/b_myButtery">My buttery</a>
        <a href="/b_orderQueue">Order queue</a>
        <a href="/b_account">Account</a>
    </div>
    <br>

    <h2>Orders in Queue</h2>
    {% if orders %}
        <div class="orders-list">
            {% for order in orders %}
                <div class="order-item">
                    <div class="order-header">
                        <h3>{{order.username}}</h3>
                        <p>Status: {{order.status}}</p>
                    </div>
                    
                    <ul>
                        {% for item in order.order_items %}
                            <li>
                                <input type="checkbox" 
                                       onchange="updateItemCheck({{order.id}}, {{item.id}}, this.checked)"
                                       {% if item.checked %}checked{% endif %}>
                                {{item.quantity}}x {{item.name}}
                                {% if item.note %}
                                    <br>Note: {{item.note}}
                                {% endif %}
                            </li>
                        {% endfor %}
                    </ul>
                    
                    <p>
                        <strong>Total: ${{"{:.2f}".format(order.total_price)}}</strong>
                    </p>
                    
                    <form action="/b_update_order_status" method="post" class="status-form">
                        <input type="hidden" name="order_id" value="{{order.id}}">
                        {% if order.status == 'pending' %}
                            <input type="hidden" name="status" value="ready">
                            <button type="submit">Mark as Ready</button>
                        {% elif order.status == 'ready' %}
                            <input type="hidden" name="status" value="picked_up">
                            <button type="submit">Mark as Picked Up</button>
                        {% endif %}
                    </form>
                </div>
                <hr>
            {% endfor %}
        </div>
    {% else %}
        <p>No orders in queue.</p>
    {% endif %}

    <script>
    function updateItemCheck(orderId, itemId, checked) {
        fetch('/b_update_item_check', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                order_id: orderId,
                item_id: itemId,
                checked: checked
            })
        }).then(response => {
            if (!response.ok) {
                console.error('Failed to update item check status');
            }
        }).catch(error => {
            console.error('Error:', error);
        });
    }
    </script>
</body>

</html>